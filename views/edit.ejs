<%- include('header') %>

<body>
  <div class="container py-4">
    <div class="text-center mb-4">
      <h3 class="fw-bold">Darul Uloom Charbari (Gazarikandi) Madrassa</h3>
      <h4 class="text-muted"> Edit Form</h4>
    </div>

    <div class="d-flex justify-content-center">
      <form action="/edit/<%= user._id %>" method="POST" class="row g-3 shadow p-4 rounded bg-light"
            style="max-width: 650px; width: 100%" enctype="multipart/form-data">
           <!-- agreeAll -->
           <div class="mb-3">
             <input type="checkbox" id="agreeAll" name="agreeAll" required <%= user.agreeAll ? 'checked' : '' %> />
             <label for="agreeAll">I have read and agree to the admission conditions</label>
           </div>
        <!-- Student Type -->
        <div class="col-md-4">
          <label class="form-label">Student Type:</label>
          <select name="type" class="form-select"  required>
            <option value="new" <%= user.type === 'new' ? 'selected' : '' %>>New</option>
            <option value="old" <%= user.type === 'old' ? 'selected' : '' %>>Old</option>
          </select>
        </div>

        <!-- Class Info -->
        <div class="col-md-4">
          <label for="class" class="form-label">Class:</label>
          <input type="text" id="class" name="class" class="form-control" value="<%= user.class %>" required />
        </div>
        <div class="col-md-4">
          <label for="prevClass" class="form-label">Previous Class:</label>
          <input type="text" id="prevClass" name="prevClass" class="form-control" value="<%= user.prevClass %>" required />
        </div>

        <!-- Name Info -->
        <div class="col-md-6">
          <label for="name" class="form-label">Name:</label>
          <input type="text" id="name" name="name" class="form-control" value="<%= user.name %>" required />
        </div>
        <div class="col-md-6">
          <label for="sonOf" class="form-label">Father's Name:</label>
          <input type="text" id="sonOf" name="sonOf" class="form-control" value="<%= user.sonOf %>" required />
        </div>

        <!-- Personal Info -->
        <div class="col-md-6">
          <label for="dateOfbrith" class="form-label">Date of Birth:</label>
          <input type="date" id="dateOfbrith" name="dateOfbrith" class="form-control" value="<%= user.dateOfbrith %>" required />
        </div>
        <div class="col-md-6">
          <label for="age" class="form-label">Age:</label>
          <input type="text" id="age" name="age" class="form-control" value="<%= user.age %>" required />
        </div>

        <!-- Address -->
        <div class="col-md-6">
          <label for="vill" class="form-label">Village:</label>
          <input type="text" id="vill" name="vill" class="form-control" value="<%= user.vill %>" required />
        </div>
        <div class="col-md-6">
          <label for="post" class="form-label">Post:</label>
          <input type="text" id="post" name="post" class="form-control" value="<%= user.post %>" required />
        </div>
        <div class="col-md-6">
          <label for="police" class="form-label">Police Station:</label>
          <input type="text" id="police" name="police" class="form-control" value="<%= user.police %>" required />
        </div>
        <div class="col-md-6">
          <label for="distric" class="form-label">District:</label>
          <input type="text" id="distric" name="distric" class="form-control" value="<%= user.distric %>" required />
        </div>
        <div class="col-md-6">
          <label for="state" class="form-label">State:</label>
          <input type="text" id="state" name="state" class="form-control" value="<%= user.state %>" required />
        </div>
        <div class="col-md-6">
          <label for="country" class="form-label">Country:</label>
          <input type="text" id="country" name="country" class="form-control" value="<%= user.country %>" required />
        </div>
        <div class="col-md-6">
          <label for="pin" class="form-label">PIN:</label>
          <input type="text" id="pin" name="pin" class="form-control" value="<%= user.pin %>" required />
        </div>

        <!-- Contact -->
        <div class="col-md-6">
          <label for="phone" class="form-label">Phone:</label>
          <input type="text" id="phone" name="phone" class="form-control" value="<%= user.phone %>" required />
        </div>
        <div class="col-md-6">
          <label for="email" class="form-label">Email:</label>
          <input type="email" id="email" name="email" class="form-control" value="<%= user.email %>" />
        </div>

        <!-- Password -->
        <div class="col-md-6">
          <label for="password" class="form-label">Password:</label>
          <input type="password" id="password" name="password" class="form-control" value="<%= user.password %>" required />
        </div>

        <!-- Photo -->
             <div class="col-md-12">
        <label class="form-label">Photo:</label>
        <input type="file" name="image" accept="image/*" class="form-control" />
        <% if (user.image) { %>
          <img src="<%= user.image %>" alt="Photo" width="100" class="mt-2 rounded">
        <% } %>
         </div>

        <!-- Payment Method -->
        <div class="col-md-6">
          <label class="form-label">Payment Method:</label>
          <select id="paymentMethod" name="payment" class="form-select" value="<%= user.payment %>" required>
            <option value="">--Select--</option>
            <option value="offline" <%= user.payment === 'offline' ? 'selected' : '' %>>Offline</option>
            <option value="online" <%= user.payment === 'online' ? 'selected' : '' %>>Online</option>
          </select>
        </div>

        <!-- Offline Payment -->
        <div class="col-md-6 d-none" id="offlineBox">
          <label class="form-label">Amount (Offline):</label>
          <input type="number" name="amount" id="offlineAmount" class="form-control" placeholder="Enter Amount" value="<%= user.amount %>" />
          <button type="button" class="btn btn-success mt-3 d-none" id="offlinePayButton">ðŸ’° Pay Offline</button>
        </div>

        <!-- Online Payment -->
        <div class="col-md-12 d-none" id="onlineBox">
          <button type="button" class="btn btn-success w-100 mt-3" id="onlinePayButton">ðŸ’³ Pay Online via UPI</button>
          <small class="text-muted d-block mt-2 text-center">
            Pay using PhonePe, Google Pay, or any UPI app
          </small>
        </div>

        <!-- Submit Button -->
        <div class="col-12 text-center">
          <button type="submit" class="btn btn-primary px-4 mt-4">Submit Admission</button>
        </div>
      </form>
    </div>
  </div>

   <%- include('footer') %>

  <script>
    const paymentMethod = document.getElementById("paymentMethod");
    const offlineBox = document.getElementById("offlineBox");
    const onlineBox = document.getElementById("onlineBox");
    const offlineAmount = document.getElementById("offlineAmount");
    const offlinePayButton = document.getElementById("offlinePayButton");
    const onlinePayButton = document.getElementById("onlinePayButton");

    // Your UPI ID
    const upiId = "alommokibul11@ybl";

    // Payment method change
    paymentMethod.addEventListener("change", function () {
      if (this.value === "offline") {
        offlineBox.classList.remove("d-none");
        onlineBox.classList.add("d-none");
        offlineAmount.value = 500;
        checkOfflineAmount();
      } else if (this.value === "online") {
        onlineBox.classList.remove("d-none");
        offlineBox.classList.add("d-none");
        offlineAmount.value = "";
        offlinePayButton.classList.add("d-none");
      } else {
        offlineBox.classList.add("d-none");
        onlineBox.classList.add("d-none");
        offlineAmount.value = "";
        offlinePayButton.classList.add("d-none");
      }
    });

    // Show Offline Pay button only if amount > 0
    offlineAmount.addEventListener("input", checkOfflineAmount);
    function checkOfflineAmount() {
      if (offlineAmount.value && parseFloat(offlineAmount.value) > 0) {
        offlinePayButton.classList.remove("d-none");
      } else {
        offlinePayButton.classList.add("d-none");
      }
    }

    // Online Pay Button click -> UPI intent
    onlinePayButton.addEventListener("click", function () {
      const amount = 700; // fixed online amount
      const upiUrl = `upi://pay?pa=${upiId}&pn=Darul+Uloom+Charbari&am=${amount}&cu=INR`;
      window.location.href = upiUrl;
    });
  </script>
</body>
</html>

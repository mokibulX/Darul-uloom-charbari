<%- include("header") %>

<div class="container my-5">

  <!-- Page Header -->
  <div class="text-center mb-5">
    <h1 class="fw-bold text-primary display-5">üìä Student Result Card</h1>
    <h3 class="text-secondary"><%= student ? student.name : "Unknown Student" %></h3>
    <p class="fs-6 text-muted">
      <strong>Class:</strong> <%= classInfo ? classInfo.name : "-" %> | 
      <strong>Exam Year:</strong> <%= examYear %> | 
      <strong>Position:</strong> <span class="badge bg-info text-dark"><%= position || '-' %></span>
    </p>
  </div>

  <!-- Student Info Card -->
  <div class="card mb-4 shadow-lg border-0 rounded-4 p-4 d-flex flex-row align-items-center">
    <img src="<%= student && student.image ? student.image : '/default.png' %>" 
         alt="Photo" 
         class="rounded-circle border border-3 border-primary me-4 shadow-sm" 
         width="120" height="120" style="object-fit: cover;">
    <div>
      <h4 class="fw-bold text-dark mb-2">Darul Uloom Charbari Annual Exam <%= examYear %></h4>
      <h5 class="fw-bold text-primary mb-1">üë§ <%= student ? student.name : "Unknown" %></h5>
      <p class="mb-1"><strong>Application ID:</strong> <%= student ? student.applicationId : '-' %></p>
      <p class="mb-1"><strong>Class:</strong> <%= classInfo ? classInfo.name : '-' %></p>
      <p class="mb-0"><strong>Position in Class:</strong> 
        <span class="badge bg-info text-dark fs-6"><%= position || '-' %></span>
      </p>
    </div>
  </div>

  <!-- Result Table -->
  <div class="card shadow-lg border-0 rounded-4 mb-4">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle text-center mb-0">
          <thead class="table-dark text-uppercase">
            <tr>
              <th>Subject</th>
              <th>Obtained Marks</th>
              <th>Pass Marks</th>
              <th>Full Marks</th>
            </tr>
          </thead>
          <tbody>
            <% kitabs.forEach(sub => { 
                 const subData = result && result.subjects ? result.subjects.find(s => s.kitab === sub) : null; 
            %>
              <tr>
                <td class="text-start fw-semibold"><%= sub %></td>
                <td class="fw-bold text-primary"><%= subData ? subData.obtainedMark : '-' %></td>
                <td>
                  <% if (subData) { %>
                    <% if (subData.obtainedMark >= 33) { %>
                      <span class="badge bg-success">33</span>
                    <% } else { %>
                      <span class="badge bg-danger">Fail</span>
                    <% } %>
                  <% } else { %>
                    -
                  <% } %>
                </td>
                <td class="fw-semibold"><%= subData ? subData.fullMark : '-' %></td>
              </tr>
            <% }) %>

            <!-- Total Marks -->
            <tr class="table-secondary fw-bold">
              <td>Total</td>
              <td colspan="3" class="text-primary fs-6"><%= result ? result.totalMarks : 0 %></td>
            </tr>

            <!-- Status -->
            <tr class="fw-bold">
              <td>Status</td>
              <td colspan="3">
                <% if (result && result.passFail === "Pass") { %>
                  <span class="badge bg-success fs-6 px-3 py-2">‚úÖ Pass</span>
                <% } else if (result && result.passFail === "Out of Consideration") { %>
                  <span class="badge bg-warning text-dark fs-6 px-3 py-2">‚ö†Ô∏è Out of Consideration</span>
                <% } else { %>
                  <span class="badge bg-danger fs-6 px-3 py-2">‚ùå Fail</span>
                <% } %>
              </td>
            </tr>

            <!-- Division -->
            <tr class="fw-bold">
              <td>Division</td>
              <td colspan="3">
                <% if(result && result.division === "1st"){ %>
                  <span class="badge bg-success fs-6 px-3 py-2">ü•á 1st Division</span>
                <% } else if(result && result.division === "2nd"){ %>
                  <span class="badge bg-info fs-6 px-3 py-2">ü•à 2nd Division</span>
                <% } else if(result && result.division === "3rd"){ %>
                  <span class="badge bg-secondary fs-6 px-3 py-2">ü•â 3rd Division</span>
                <% } else { %>
                  <span class="badge bg-danger fs-6 px-3 py-2">Fail</span>
                <% } %>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="d-flex justify-content-center gap-3">
  <a href="/results/view?classId=<%= classInfo._id %>&examYear=<%= examYear %>" class="btn btn-warning fw-bold px-4">
  Back to Class Results
</a>

    <a href="/student/result/<%= student._id %>/pdf?classId=<%= classInfo._id %>&examYear=<%= examYear %>" 
       class="btn btn-warning fw-bold px-4">üìÑ Download PDF</a>
  </div>

</div>

<%- include("footer") %>
